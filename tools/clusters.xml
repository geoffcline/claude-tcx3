<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "file://zonbook/docbookx.dtd"
 [
  <!ENTITY % xinclude SYSTEM "file://AWSShared/common/xinclude.mod">
  %xinclude;
  <!ENTITY % phrases-shared SYSTEM "file://AWSShared/common/phrases-shared.ent">
  %phrases-shared;
  <!ENTITY % phrases-eks SYSTEM "../../shared/phrases-eks.ent"> 
  %phrases-eks;
 ]>
<!--
  Content maintained by: gcline
  Last refreshed: 
  Engineering contact: https://oncall.corp.amazon.com/#/view/eks-control-plane-primary/schedule
  Quip: https://quip-amazon.com/2ffJOa54PxUh
-->
<chapter id="clusters" xmlns:xi="http://www.w3.org/2001/XInclude">
    <info>
        <title id="clusters.title">What is an &EKS; potato cluster?</title>
        <titleabbrev>Clusters lmao</titleabbrev>
        <abstract><para>Learn lmao how to create, manage, and configure Amazon EKS clusters to run Kubernetes workloads on &AWS; securely and reliably.</para></abstract>
    </info>
    <para>An &EKS; cluster consists of two primary components:</para>
    <itemizedlist>
        <listitem>
            <para>The &EKS; control plane</para>
        </listitem>
        <listitem>
            <para>&EKS; nodes that are registered with the control plane</para>
        </listitem>
    </itemizedlist>
    <para>The &EKS; control plane consists of control plane nodes that run the &k8s; software,
        such as <code>etcd</code> and the &k8s; API server. The control plane runs in an
        account managed by &AWS;, and the &k8s; API is exposed via the &EKS; endpoint
        associated with your cluster. &cluster-single-tenant;</para>
    <para>All of the data stored by the <code>etcd</code> nodes and associated &EBS; volumes is
        encrypted using &KMS;. The cluster control plane is provisioned across multiple &AZ;s and
        fronted by an &ELB; &NLB;. &EKS; also provisions elastic network interfaces in your VPC
        subnets to provide connectivity from the control plane instances to the nodes (for example,
        to support <!-- <command> -->
        <code>kubectl exec</code>
        <code>logs</code>
        <code>proxy</code> data flows).</para>
    <important>
        <para><remark>https://sim.amazon.com/issues/AWSDocsSchedule-33123</remark>In the &EKS;
            environment, <code>etcd</code> storage is limited to 8 GiB as per <ulink
                url="https://etcd.io/docs/v3.5/dev-guide/limit/#storage-size-limit">upstream</ulink>
            guidance. You can monitor a metric for the current database size by running the
            following command. If your cluster has a &k8s; version below <code>1.28</code>, replace
                    <code><replaceable>apiserver_storage_size_bytes</replaceable></code> with the
            following:</para>
        <itemizedlist>
            <listitem>
                <para>&k8s; version <code>1.27</code> and <code>1.26</code> &endash;
                            <userinput><code>apiserver_storage_db_total_size_in_bytes</code></userinput></para>
            </listitem>
            <listitem>
                <para>&k8s; version <code>1.25</code> and below &endash;
                            <userinput><code>etcd_db_total_size_in_bytes</code></userinput></para>
            </listitem>
        </itemizedlist>
        <programlisting language="bash"><userinput>kubectl get --raw=/metrics | grep "<replaceable>apiserver_storage_size_bytes</replaceable>"
</userinput></programlisting>
    </important>
    <para>&EKS; nodes run in your &AWS; account and connect to your cluster's control plane via the
        API server endpoint and a certificate file that is created for your cluster.</para>
    <note>
        <itemizedlist>
            <listitem>
                <para>You can find out how the different components of &EKS; work in <xref
                        linkend="eks-networking" endterm="eks-networking.title"/>. </para>
            </listitem>
            <listitem>
                <para>For connected clusters, see <xref linkend="eks-connector"
                        endterm="eks-connector.title"/>.</para>
            </listitem>
        </itemizedlist>
    </note>
    <para role="topiclist"/>
    <xi:include href="create-cluster.xml"/>
    <xi:include href="cluster-insights.xml"/>
    <xi:include href="update-cluster.xml"/>
    <xi:include href="delete-cluster.xml"/>
    <xi:include href="endpoint.xml"/>
    <xi:include href="enable-secret-encryption.xml"/>
    <xi:include href="windows-support.xml"/>
    <xi:include href="private-clusters.xml"/>  
    <xi:include href="kubernetes-versions.xml"/>
    <xi:include href="platform-versions.xml"/>
    <xi:include href="autoscaling.xml"/>
</chapter>
